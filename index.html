<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EchoVerse - Share Your Story</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
        ðŸŒ™
    </button>

    <main>
        <section class="landing-hero">
            <h1 class="brand-title">EchoVerse</h1>
            <p class="tagline">People judge. We donâ€™t. <br> Let your Echo travel through the Verse.</p>
            <button class="cta-button" id="postEchoBtn">Share Your Story</button>
            <div class="scroll-prompt" id="scrollPrompt">â†“</div>
        </section>

        <div class="container">
            <div class="composer" id="echoInput" style="display: none;">
                <textarea placeholder="Write your echo..." id="echoText"></textarea>
                <div class="row">
                    <button class="button primary" id="submitEcho">Let your Echo be heard</button>
                </div>
            </div>

            <div class="stories" id="echoStream">
                <!-- Echo cards will be dynamically inserted here -->
            </div>
        </div>
    </main>

    <script type="module">
        import { SUPABASE_URL, SUPABASE_KEY } from './config.js';

        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;
        
        themeToggle.addEventListener('click', () => {
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            themeToggle.textContent = newTheme === 'light' ? 'ðŸŒ™' : 'â˜€ï¸';
        });

        // Show/Hide Echo Input and Smooth Scroll
        const postEchoBtn = document.getElementById('postEchoBtn');
        const scrollPrompt = document.getElementById('scrollPrompt');
        const echoInput = document.getElementById('echoInput');
        
        function scrollToContent() {
            echoInput.style.display = 'block';
            echoInput.scrollIntoView({ behavior: 'smooth' });
        }
        
        postEchoBtn.addEventListener('click', scrollToContent);
        scrollPrompt.addEventListener('click', scrollToContent);

        // Initialize Supabase
        const { createClient } = supabase;
        const supabaseClient = createClient(
            SUPABASE_URL,
            SUPABASE_KEY
        );

        // Submit Echo
        const submitEcho = document.getElementById('submitEcho');
        const echoText = document.getElementById('echoText');

        submitEcho.addEventListener('click', async () => {
            const content = echoText.value.trim();
            if (!content) return;

            try {
                const { data, error } = await supabaseClient
                    .from('echoes')
                    .insert([{ content, created_at: new Date() }]);

                if (error) throw error;

                echoText.value = '';
                loadEchoes();
            } catch (error) {
                console.error('Error posting echo:', error);
            }
        });

        // Load Echoes
        async function loadEchoes() {
            try {
                const { data, error } = await supabaseClient
                    .from('echoes')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(10);

                if (error) throw error;

                const echoStream = document.getElementById('echoStream');
                echoStream.innerHTML = '';

                data.forEach(echo => {
                    const timeAgo = new Date(echo.created_at).toLocaleDateString();
                    const card = document.createElement('div');
                    card.className = 'story fade-in';
                    card.innerHTML = `
                        <div class="meta">${timeAgo}</div>
                        <div class="content">${echo.content}</div>
                     
                    `;
                    echoStream.appendChild(card);
                });
            } catch (error) {
                console.error('Error loading echoes:', error);
            }
        }

        // Listen Button
        const listenBtn = document.getElementById('listenBtn');
        listenBtn.addEventListener('click', () => {
            loadEchoes();
            document.querySelector('.stories').scrollIntoView({ behavior: 'smooth' });
        });

        // Initialize page
        loadEchoes();
    </script>
</body>
</html>
