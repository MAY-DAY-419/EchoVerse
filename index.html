<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="EchoVerse" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="theme-color" content="#c7a0f1" />
    <title>EchoVerse</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" href="/assets/sample.svg" type="image/svg+xml" />
    <!-- iOS home screen icon (replace with PNG when available) -->
    <link rel="apple-touch-icon" href="https://via.placeholder.com/180.png?text=EV" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
</head>
<body>
    <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">ðŸŒ™</button>

    <main>
        <section class="landing-hero">
            <h1 class="brand-title">EchoVerse</h1>
            <p class="tagline">People judge. We don't.<br />Let your Echo travel through the Verse.</p>
                        <div style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
                            <button class="cta-button" id="loginBtn">Login</button>
                            <button class="cta-button" id="installBtn" style="display:none;">Install App</button>
                        </div>
        </section>
    </main>

    <!-- Login Modal -->
    <div id="loginModal" class="modal" aria-hidden="true">
        <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
            <h2 id="loginTitle">Login to EchoVerse</h2>
            <input type="text" id="username" placeholder="Username" autocomplete="username" />
            <input type="password" id="password" placeholder="Password" autocomplete="current-password" />
            <button class="cta-button" id="submitLogin">Enter</button>
            <p id="errorMsg" style="color:#ff6b6b; display:none; margin-top:10px;"></p>
        </div>
    </div>

    <script>
    // Theme setup
        const html = document.documentElement;
        const themeToggle = document.getElementById('themeToggle');
        const savedTheme = localStorage.getItem('theme') || 'light';
        html.setAttribute('data-theme', savedTheme);
        themeToggle.textContent = savedTheme === 'light' ? 'ðŸŒ™' : 'â˜€ï¸';
        themeToggle.addEventListener('click', () => {
            const current = html.getAttribute('data-theme');
            const next = current === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', next);
            themeToggle.textContent = next === 'light' ? 'ðŸŒ™' : 'â˜€ï¸';
            localStorage.setItem('theme', next);
        });

        // Modal + login
        const loginBtn = document.getElementById('loginBtn');
        const loginModal = document.getElementById('loginModal');
        const submitLogin = document.getElementById('submitLogin');
        
        // Hardcoded credentials
        const USERS = [
            { username: 'UNSHREKABLE', password: 'MAYDAYPASS', redirect: 'echo.html', type: 'main' },
            { username: 'ShreyaDhamankar', password: 'Shreya@123', redirect: 'whisper.html', type: 'decoy' }
        ];

        loginBtn.addEventListener('click', () => {
            loginModal.style.display = 'flex';
            loginModal.setAttribute('aria-hidden', 'false');
            document.getElementById('username').focus();
        });

        // Close modal by clicking outside
        loginModal.addEventListener('click', (e) => {
            if (e.target === loginModal) {
                loginModal.style.display = 'none';
                loginModal.setAttribute('aria-hidden', 'true');
            }
        });

        // Submit login
        submitLogin.addEventListener('click', () => {
            const u = document.getElementById('username').value.trim();
            const p = document.getElementById('password').value;
            const errorMsg = document.getElementById('errorMsg');
            
            const user = USERS.find(usr => usr.username === u && usr.password === p);
            if (user) {
                localStorage.setItem('echoverse_auth', 'true');
                localStorage.setItem('echoverse_user_type', user.type);
                window.location.href = user.redirect;
            } else {
                errorMsg.textContent = 'Invalid credentials';
                errorMsg.style.display = 'block';
            }
        });

        // Enter key submits
        document.getElementById('password').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') submitLogin.click();
        });

        // PWA install prompt
        let deferredPrompt;
        const installBtn = document.getElementById('installBtn');
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'inline-block';
        });
        installBtn?.addEventListener('click', async () => {
            if (!deferredPrompt) return;
            deferredPrompt.prompt();
            await deferredPrompt.userChoice;
            deferredPrompt = null;
            installBtn.style.display = 'none';
        });

        // iOS tip (no beforeinstallprompt)
        const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
        const isInStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
        if (isIOS && !isInStandalone) {
            installBtn.style.display = 'inline-block';
            installBtn.textContent = 'Add to Home Screen';
            installBtn.onclick = () => alert('On iOS: Tap Share, then "Add to Home Screen"');
        }

        // Register service worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(() => {});
        }
    </script>
</body>
</html>
